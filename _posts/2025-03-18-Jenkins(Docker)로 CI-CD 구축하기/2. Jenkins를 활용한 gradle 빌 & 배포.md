ì›Œì»¤ ì¸ìŠ¤í„´ìŠ¤ ì„œë²„ ëŠ” 97ë²ˆìœ¼ë¡œ í•œë‹¤  : https://velog.io/@mooh2jj/jenkins-docker-gradle-%EC%9E%90%EB%8F%99%EB%B0%B0%ED%8F%AC  ì°¸ê³ 

## 1. ngrok ì„¤ì •
ngrok ì„¤ì •
ì„¤ì •ì´ ë˜ì–´ìˆë‹¤ë©´ ë„˜ì–´ê°€ë„ ëœë‹¤.

ì•„ë‹ˆë¼ë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì—¬ ì„¤ì¹˜í•œë‹¤
https://ngwdeveloper.tistory.com/163

* 97ë²ˆ ì„œë²„ì—ì„œ
* ngrok ì„¤ì¹˜ëœê±° í™•ì¸í•˜ê³ 
* 
```
$ ngrok http 9000
```
* ì—ëŸ¬ ë°œìƒ
  authentication failed: Usage of ngrok requires.... 
  * ê·¸ë˜ì„œ ngrok ì‚¬ì´íŠ¸ ê°€ì„œ íšŒì›ê°€ì…í•˜ê³  https://dashboard.ngrok.com/get-started/your-authtoken ì—ì„œ 'í† í°ê°’ í™•ì¸í›„
  * ngrok config add-authtoken 'í† í°ê°’' í•´ì¤€í›„
```
$ ngrok http 9000
Web Interface                 http://127.0.0.1:4040
Forwarding                    https://ea6d-121-130-10-5.ngrok-free.app -> http://localhost:9000
```
* í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œ https://ea6d-121-130-10-5.ngrok-free.app í•˜ë‹ˆ 
* ì—­ì‹œ Vist Site .. ì–´ì©Œêµ¬ í™”ë©´ì´ ë‚˜ì™€ì„œ https://ngwdeveloper.tistory.com/163 ì°¸ê³ í•´ì„œ í¬ë¡¬ ì¶”ê°€ ì„¤ì • í•´ì£¼ê³  ì§„í–‰í•˜ë‹ˆ 
* https://ea6d-121-130-10-5.ngrok-free.app/  ê°€ ì  í‚¨ìŠ¤ url ì´ ë¨
* ì´ì œ ëª¨ë°”ì¼ì—ì„œë„ ì ‘ì†ì´ ë¨....


## 2. ì  í‚¨ìŠ¤ í”„ë¡œì íŠ¸ êµ¬ì„±
ìƒˆë¡œìš´ Item > í”„ë¡œì íŠ¸ëª… docker-jenkins-github-testìœ¼ë¡œ.
Freestyle projectë¡œ í•´ë†“ì•˜ë‹¤.

* ì†ŒìŠ¤ì½”ë“œê´€ë¦¬ > Git
  * Repositroy URL -> ë°°í¬í•  í”„ë¡œì íŠ¸ URL ì´ë¦„ì„ ì…ë ¥í•œë‹¤. : https://github.com/DeoksangHan/springboot-developer.git
  * Branch Specifier (blank for 'any') : */main

* Build Steps
  * Freestyle project Build ë°©ë²•ì— 2ê°€ì§€ë¥¼ ì†Œì¬í•˜ê² ìŠµë‹ˆë‹¤.
    * 1. Excute Shell (ì¶”ì²œ)
      * Add build step -> Excute Shell ì„ íƒ
```
Commandì— ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•œë‹¤.
chmod +x gradlew
./gradlew clean build
```
      * 2. Invoke Gradle script & Use Gradle Wrapper
        * Add build step -> Invoke Gradle scriptë¥¼ ì„ íƒ -> Use Gradle Wrapper
        * Invoke Gradleì„ ì„ íƒí•  ê²½ìš° Jenkinsì— Global Toll Configurationì—ì„œ Gradle íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        * Use Gradle Wrapperì˜ ê²½ìš° Gradleì„ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ë‹¤.
        * Make gradlew executableë„ ì²´í¬í•´ì¤€ë‹¤. ì²´í¬í•˜ë©´ ê¶Œí•œ ë¬¸ì œë¡œ ì‹¤í–‰ì´ ì•ˆ ë˜ëŠ” ìƒí™©ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
        * Tasksì— clean buildë¥¼ ì…ë ¥í•˜ë©´ Build ì •ì˜ëŠ” í•œì°¨ë¡€ ì™„ë£Œëœ ê²ƒì´ê²Œ ë©ë‹ˆë‹¤.

  * 2. ë²ˆ ë°©ë²•ìœ¼ë¡œ ì§„í–‰ 
  * ê·¸ë‹¤ìŒ Build Now (ì§€ê¸ˆ ë¹Œë“œ) í•´ì„œ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ëŠ” ì§€ í™•ì¸.
    * Jenkinsì—ì„œ Gradle Buildë¥¼ í•˜ê²Œ ë  ê²½ìš° /var/lib/jenkins/build/libs ì— jar íŒŒì¼ì´ ìœ„ì¹˜
    * jenkins-docker ë‚´ë¶€ë¡œ ì§„ì…
      * docker exec -u root -it jenkins-docker bash
        * /var/jenkins_home/workspace/docker-jenkins-github-test/build/libs ì—
        * backend-test01-1.0-SNAPSHOT.jar ì´ ìˆëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤
        * 

  * github ì‚¬ì´íŠ¸ê°€ public ì´ë¼ ë”°ë¡œ ì¸ì¦ ê´€ë ¨ ì„¤ì •ì´ ì—†ì–´ë„ ì§„í–‰ì´ ëœë‹¤
  * private ì´ë¼ë©´ ì¸ì¦ í”„ë¡œì„¸ìŠ¤ê°€ ìˆì–´ì•¼ í•œë‹¤....



SSHì„œë²„ì— jar íŒŒì¼ ë°°ì¹˜ & excute commands êµ¬ì„±í•˜ê¸°
Build > Send files or excute commands over SSH
ì—¬ê¸°ì„  Transfersì—ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ ë¹Œë“œí•œ íŒŒì¼ì„ Service Server(SSH ì„œë²„)ë¡œ ë³´ë‚´ê³  ë°°í¬í•˜ëŠ” í–‰ìœ„ë¥¼ ì •ì˜í•˜ëŠ” ê²ƒì´ë‹¤.

SSH Server : publish over SSH í¼í™”ë©´ì— ë“±ë¡í•œ ì„œë²„


Name : ì¶”ê°€í•œ SSH Serverì˜ ì´ë¦„ì´ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë‚˜íƒ€ë‚œ ê±¸ ì„ íƒ.

Source files : build/libs/*jarë¡œ ì •ì˜í•œë‹¤.
Remove prefix : build/libs
Remote directory : /service_server/target
Build Serverì˜ Jenkins ê³„ì •ì˜ ë£¨íŠ¸ ê²½ë¡œëŠ” /var/lib/jenkinsë‹¤.

Jenkinsì—ì„œ Gradle Buildë¥¼ í•˜ê²Œ ë  ê²½ìš° /var/lib/jenkins/build/libs ì— jar íŒŒì¼ì´ ìœ„ì¹˜í•˜ê²Œ ë˜ë¯€ë¡œ

Remote directoryëŠ” íŒŒì¼ì„ ì „ì†¡ë°›ëŠ” Service Serverì˜ ê²½ë¡œë¥¼ ì˜ë¯¸í•œë‹¤.

SSH ì ‘ì† ë£¨íŠ¸ë¥¼ /home/ubuntuë¡œ ë˜ì–´ìˆìœ¼ë¯€ë¡œ ê²°ê³¼ì ìœ¼ë¡œ Remote directoryëŠ”

/home/ubuntu/service_server/targetì´ ë  ê²ƒì´ë‹¤.

Service Serverì—ì„œ ë¯¸ë¦¬ service_server/target ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•´ ì£¼ì.

ë˜í•œ í”„ë¡œì íŠ¸ êµ¬ë™ ì‹œì˜ ë¡œê·¸ íŒŒì¼ì„ ì €ì¥í•˜ê¸° ìœ„í•œ logs ë””ë ‰í„°ë¦¬ë„ í•¨ê»˜ ë§Œë“¤ì–´ì£¼ì.

# Service Server 
mkdir -p ~/service_server/target 
mkdir -p ~/service_server/logs

ì´ì œ Exec commandë¥¼ ì‘ì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.

ì´ê³³ì—ëŠ” ë¹Œë“œê°€ ì™„ë£Œë˜ì–´ jaríŒŒì¼ì´ Service Serverì— ì „ë‹¬ë˜ê³  ë‚œ í›„ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ê³³ì´ë‹¤.

ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì‘ì„±í•´ë„ ë˜ê³  .shíŒŒì¼ì„ ë¯¸ë¦¬ ì¤€ë¹„í–ˆë‹¤ ê·¸ê²ƒì„ ì‹¤í–‰í•˜ëŠ” í˜•íƒœë¡œ í•´ë„ ë¬´ë°©í•˜ë‹¤.

ë³¸ ì˜ˆì œì—ì„œëŠ” ìŠ¤í¬ë¦½íŠ¸ êµ¬ë¬¸ì„ ì§ì ‘ ì…ë ¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•œë‹¤.

ì•„ë˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ Exec commandsì— ì…ë ¥í•œë‹¤.

echo "PID Check..." 

CURRENT_PID=$(ps -ef | grep java | grep gradle-springboot-test* | awk '{print $2}') 

echo "Running PID: {$CURRENT_PID}" 

if "$CURRENT_PID" [ -z CURRENT_PID ] ; then 
	echo "Project is not running"
â€‹else 
	kill -9 $CURRENT_PID 
	sleep 10 
fi 

echo "Deploy Project...." 

nohup java -jar /home/ubuntu/service_server/target/gradle-springboot-test-0.0.1-SNAPSHOT.jar >> /home/ubuntu/service_server/logs/gradle-springboot-test.log & 

echo "Done"

ğŸ’¥ì£¼ì˜) ì—¬ê¸°ì„œ jar íŒŒì¼ ì´ë¦„ì€ í”„ë¡œì íŠ¸ëª…ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì˜ í™•ì¸í•˜ê³  ê¸°ì…í•˜ì!
ë‚œ ë‹¬ë¼ì„œ ë°°í¬ëœ jar ì´ë¦„ í™•ì¸í•˜ê³  ê¸°ì…í–ˆë‹¤.


ì‹¤ì œ ë°°í¬ë„ ì˜ ëê³  ë¸Œë¼ìš°ì € í™•ì¸ì„ ì˜ ì‹¤í•´ëœ ê²ƒë„ í™•ì¸ëë‹¤.






ğŸ’¥Unstable ìƒíƒœ ì˜¤ë¥˜ í•´ê²°ë°©ë²•
ì¶œì²˜: https://oingdaddy.tistory.com/189 [SI Supply Depot]

Build Nowë¥¼ í•˜ê³  ì½˜ì†” ì¶œë ¥ì„ ë³´ë‹ˆ Build Successê°€ ë‚˜ì™”ë‹¤. í•˜ì§€ë§Œ ì ì‹œ Unstable ìƒíƒœ ì˜¤ë¥˜ëŠ” ë‚œë‹¤...



SSH: Disconnecting configuration [batch_001] ...
ERROR: Exception when publishing, exception message [Exec timed out or was interrupted after 213,127 ms]
Build step 'Send files or execute commands over SSH' changed build result to UNSTABLE
ê²°ë¡ ì€ timeout ê´€ë ¨ëœ ì˜¤ë¥˜ë‹¤.

JenkinsëŠ” ìŠ¤ì¼€ì¥´ëŸ¬ ì—­í• ì„ í•˜ëŠ” ë…€ì„ìœ¼ë¡œ Bë¼ëŠ” ì„œë²„ì— ì˜¬ë¼ê°€ ìˆê³  Aë¼ëŠ” ì„œë²„ì—ëŠ” Batch instanceê°€ ì˜¬ë¼ê°€ìˆë‹¤. ì´ Bê°€ Aí•œí…Œ sshë¥¼ ì‚¬ìš©í•´ "batch ìˆ˜í–‰í•´!" ë¼ê³  ëª…ë ¹í–ˆê³  AëŠ” ì—´ì‹¬íˆ ì¼ì„ í–ˆëŠ”ë° BëŠ” ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ë‹¤ê°€ timeoutì´ ë‚œ ê²ƒì´ë‹¤.

í•´ê²°ì±…ì€ ê°„ë‹¨í•˜ë‹¤. ëª…ë ¹ì„ ë‚ ë¦¬ëŠ” Jenkins(B)ê°€ ì¶©ë¶„í•œ ì‹œê°„ë™ì•ˆ ê¸°ë‹¤ë ¤ì¤„ìˆ˜ ìˆë„ë¡ timeout ì˜µì…˜ì„ ë³€ê²½í•´ì£¼ë©´ ëœë‹¤.

Exec timeout (ms) -> 0(ë¬´í•œì‹œê°„)ìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.


ì €ì¥í•˜ê³  Build Nowë¥¼ í•˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.




ì°¸ê³ 
https://dev-overload.tistory.com/39
https://velog.io/@sa1341/Jenkins%EC%97%90%EC%84%9C-EC2%EB%A1%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0
ì†ŒìŠ¤ì¶œì²˜ : https://github.com/mooh2jj/docker-jenkins-github-test.git

