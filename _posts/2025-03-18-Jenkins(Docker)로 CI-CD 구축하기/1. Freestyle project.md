## 1. Jenkins 설치
스프링부트 프로젝트의 버전이 3.0.0 이상이면 jdk17 버전 이상부터 지원이 되므로 jdk17 버전 jenkins 이미지를 받는다.
```
docker pull jenkins/jenkins:jdk17
```
## 2. Jenkins 실행
도커 Repository명 확인
```
docker images
```
### type 1. Jenkins 명령어 실행 및 확인
```
docker run -d -p 8081:8080 --name jenkins -u root jenkins/jenkins:jdk17
docker ps
```
### type 2. Dockerfile 로 실헹
```
# dshan/ci_cd_test/jenkins/jenkins-dockerfile

FROM jenkins/jenkins:jdk17

USER root
RUN apt-get update &&\
    apt-get upgrade -y &&\
    apt-get install -y openssh-client
```
type 2 형식으로 진행한다 

위의 openssh-client 가 Jenkins에 필요한 이유는 빌드가 완료된 프로젝트를 Jenkins(컨테이너) 외부의 서버에서 실행시켜야 하기 때문에 
ssh 를 통해 서버에 접속해 빌드된 프로젝트를 실행시키는 방법을 사용하기 위함

해당 Dockerfile을 바탕으로 Docker 컨테이너를 생성해주는 docker-compose.yml(컨테이너 생성을 위함) 을 작성한다
```
# dshan/ci_cd_test/jenkins/docker-compose.yml

version: "3.1"
services:
  jenkins:
    container_name: jenkins
    build:
      context: jenkins-dockerfile
      dockerfile: Dockerfile
    restart: unless-stopped
    user: root
    ports:
      - 8888:8080
      - 50000:50000
    volumes:
      - /home/dshan/ci_cd_test/jenkins/jenkins_home:/var/jenkins_home
      - /home/dshan/ci_cd_test/jenkins/.ssh:/root/.ssh

```
* 위의 volumes 옵션이 필요한 이유는 독립된 Jenkins 컨테이너 외부에 저장소를 둠으로써 데이터를 지속적으로 저장할 수 있기 때문이다.
"서버의 저장 경로  : 도커 컨테이너의 저장 경로"와 같은 식으로 저장소를 공유 가능
* restart: unless-stopped는 서버가 재시작할 때 해당 컨테이너도 자동으로 재실행됨을 의미
* docker-compose 설치
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
docker-compose --version
```
  
* docker-compose 파일을 up 해준다
* 모든 이미지를 새로 빌드해서 컨테이너를 생성하고 싶다면, 아래 명령어를 사용한다.
* up 명령어
  * docker run 커맨드와 비슷
  * 정의 파일에 기재된 내용대로 이미지를 내려받고 컨테이너를 생성 및 실행.
  * 정의 파일에는 네트워크나 볼륨에 대한 정의도 기재할 수 있어서 주변 환경을 한꺼번에 생성 가능함.
* down 명령어
  * 컨테이너와 네트워크를 정지 및 삭제.
  * 볼륨과 이미지는 삭제하지 않음
  * 컨테이너와 네트워크 삭제 없이 종료만 하고 싶다면 stop 커맨드를 사용.

* -d 는 백그라운드로 실행하라는 의미
* --build 컨테이너를 실행하기전에 이미지를 빌드

```
docker-compose [-f docker-compose.yml][→ 생략가능] up --build -d
``` 
```
docker-compose -f docker-compose.yml up --build -d
```
* 8888 port address already in use 에러남
  * netstat -tnlp | grep 8888  으로 확인
    * tcp        0      0 127.0.0.1:8888          0.0.0.0:*               LISTEN      578927/python
  * kill -9 578927
* 다시 docker-compose -f docker-compose.yml up --build -d 하니까 성공 메시지 나옴
```
   .....
   Successfully built 1c57bdebc07a6d92cd590ec5dc8e5d1f89c871eccc652f4ea9e15d7e51cc6a87
   Starting jenkins ... done
```

* 정상적으로 컨테이너가 올라간 것을 확인하면 웹브라우저를 통해 접속한다.
* 이때 jenkins_home .ssh 폴더도 생성되어 있는지 확인한다
```
http://192....97:8888/
```
* 화면이 뜬다면 설치한 Jenkins 도커의 로그를 열어 랜덤하게 써있는 문자열을 복사하여 붙여넣는다.
```
docker logs jenkins
```
* 다음 화면에서 Install suggested plugins 를 (왼쪽버튼) 클릭한다...그럼 설치가 시작되는데 시간이 좀 걸린다..
* 설치가 완료되면 계정 생성창이 나오는데 전부 입력 해준다.
   * 계정명 : admin
   * 암호, 암호확인 : v~
   * 이름 : 관리자-hds
   * 이메일주소 : hdeoksang@gmail.com
* http://192....97:8888/
* 설치 성공화면 : Jenkins is ready! -> Start using Jenkins 버튼 클릭 -> 관리자계정 초기화면으로 표시가 된다
* 
 

