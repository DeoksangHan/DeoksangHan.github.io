jenkinsë¥¼ AWS EC2(Ubuntu20.04) ì„¤ì¹˜í•˜ëŠ” 2ê°€ì§€ ë°©ì‹ì´ ìˆë‹¤.
1) jenkins ìì²´ ì„¤ì¹˜
2) Docker ì´ë¯¸ì§€ë¡œ ì„¤ì¹˜
## Jenkins ìì²´ ì„¤ì¹˜
```
ë‚˜ì¤‘ì— í•´ë³´ì
```
## Docker ì´ë¯¸ì§€ë¡œ ì„¤ì¹˜ ë° ì‹¤í–‰í•˜ê¸° ( 2) ë°©ì‹ìœ¼ë¡œ ì§„í–‰)
Dockerë¡œ ì´ë¯¸ jenkins ì´ë¯¸ì§€ê°€ ê³µì‹ì ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, jenkins docker ì´ë¯¸ì§€ë¥¼ ì°¾ì•„ì„œ(dockerHub), runë§Œ í•˜ë©´ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜ì™€ ì‹¤í–‰ì´ ë™ì‹œì— ì§„í–‰ì‹œí‚¬ ìˆ˜ìˆë‹¤!

Ubuntu EC2ì— Docker ì„¤ì¹˜ëŠ” ì´ ë¸”ë¡œê·¸ ì°¸ê³  : https://velog.io/@mooh2jj/AWS-EC2-Docker-ì„¤ì¹˜

* Dockerê°€ ì„¤ì¹˜ ì´í›„ jenkins run ëª…ë ¹ì–´ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
### 1) docker ëª…ë ¹ì–´
```
# jenkins ì‹¤í–‰ : 97ë²ˆì„œë²„ : /home/dshan/ci_cd_test/jenkins  í´ë”ì—ì„œ 
docker run \
  --name jenkins-docker \
  -p 9000:8080 -p 50000:50000 \
  -e TZ=Asia/Seoul \
  -v /home/dshan/ci_cd_test/jenkins:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /usr/bin/docker:/usr/bin/docker \
  -u root \
  -d \
  jenkins/jenkins:jdk17
```
docker psë¡œ í™•ì¸
```
#753ebaa3695b   jenkins/jenkins:lts      "/usr/bin/tini -- /uâ€¦"   7 days ago   Up 20 seconds       0.0.0.0:50000->50000/tcp, 0.0.0.0:9000->8080/tcp   jenkins-docker
```

ğŸ’¥ docker not found ì˜¤ë¥˜

@tmp/durable-61dd8bff/script.sh: 1: docker: not found
jenkins runì‹œ ì´ volume ì„¤ì •ì„ ê¼­ í•´ì¤˜ì•¼ ìœ„ ì˜¤ë¥˜ê°€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤.
```
-v /var/run/docker.sock:/var/run/docker.sock
-v /usr/bin/docker:/usr/bin/docker
```
ê´€ë ¨ë¸”ë¡œê·¸: https://blog.riyenas.dev/jenkins_pipeline_docker_not_found/

or

### 2) docker-compose íŒŒì¼ë¡œ ì‹¤í–‰ : ì´ ë°©ì‹ìœ¼ë¡œ ì§„í–‰
```
$ vim docker-compose.yml

# dshan/ci_cd_test/jenkins/docker-compose.yml

version: "3.7"
services:
  jenkins:
    image: jenkins:jdk17
    container_name: jenkins-docker
    build:
      context: jenkins-dockerfile
      dockerfile: Dockerfile
    restart: unless-stopped
    user: root
    ports:
      - 9000:8080
      - 50000:50000
    volumes:
      - /home/dshan/ci_cd_test/jenkins/jenkins_home:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock

$ cd /home/dshan/ci_cd_test/jenkins/jenkins-dockerfile
$ vim Dockerfile
# dshan/ci_cd_test/jenkins/jenkins-dockerfile/Dockerfile

FROM jenkins/jenkins:jdk17

USER root
RUN apt-get update &&\
    apt-get upgrade -y &&\
    apt-get install -y openssh-client
```
* -d : ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
```
$ docker-compose -f docker-compose.yml up --build -d
```
í•˜ë©´ jenkin:jdk17 ë„ì»¤ ì´ë¯¸ì§€ ê°€ ìƒì„±ë˜ê³  jenkins-docker ì´ë¦„ìœ¼ë¡œ docker run ê¹Œì§€ ì§„í–‰ì´ ëœë‹¤
```
docker images
docker ps -a   ë¡œ í™•ì¸í•´ë³¸ë‹¤.
```

ê·¸ì™¸ ëª…ë ¹ì–´
ì´ë¯¸ ì»¨í…Œì´ë„ˆê°€ ìˆì„ì‹œ ì¬ì‹œì‘ ëª…ë ¹ì–´
# jenkins ì¬ì‹œì‘
docker restart [ì»¨í…Œì´ë„ˆID]
jenkins ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°ˆë ¤ë©´
# jenkins ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it [jenkins ì»¨í…Œì´ë„ˆID] bin/bash
jenkins ì»¨í…Œì´ë„ˆ ë¡œê·¸ë¥¼ í™•ì¸í• ë ¤ë©´
# jenkins ì»¨í…Œì´ë„ˆ log í™•ì¸
docker logs [jenkins ì»¨í…Œì´ë„ˆID]

### Jenkins í˜ì´ì§€ ì—´ê¸°
Jenkinsì˜ ê¸°ë³¸í¬íŠ¸ëŠ” 8080ì´ë‹¤.
8080 í¬íŠ¸ë¥¼ ì—´ê¸° ìœ„í•œ ë°˜ë“œì‹œ ì  í‚¨ìŠ¤ê°€ ì„¤ì¹˜ëœ AWS EC2 ì¸ìŠ¤í„´ìŠ¤ ì¸ë°”ìš´ë“œ ê·œì¹™ì— 8080í¬íŠ¸ë¥¼ ì—´ì–´ì¤˜ì•¼ í•œë‹¤.

URL ì…ë ¥ì°½ì— {ec2 ì¸ìŠ¤í„´ìŠ¤ pulbic ipv4ì£¼ì†Œ}:8080ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë©´, ë“œë””ì–´ jenkins í˜ì´ì§€ê°€ ì—´ë¦¬ê³ 

íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥ ì°½ í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤. ì—¬ê¸°ì—” ì  í‚¨ìŠ¤ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤ê³  í•œë‹¤.

ì  í‚¨ìŠ¤ íŒ¨ìŠ¤ì›Œë“œëŠ” catìœ¼ë¡œ ì•„ë˜ ê²½ë¡œë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

* ì´ˆê¸° íŒ¨ìŠ¤ì›Œë“œ í™•ì¸
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
* docker ì´ë¯¸ì§€ë¡œ ë°°í¬ì‹œ í™•ì¸
docker exec jenkins-docker cat /var/jenkins_home/secrets/initialAdminPassword
* ë‚´ê²½ìš°ì—”
* ë¸Œë¼ìš°ì €ì—ì„œ 192.....97:9000 ìœ¼ë¡œ ë“¤ì–´ê°„í›„
* í„°ë¯¸ë„ì—ì„œ
```
docker exec jenkins-docker cat /var/jenkins_home/secrets/initialAdminPassword 
```

ê·¸ë¦¬ê³  íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  ë“¤ì–´ê°€ë³´ë©´ jenkins plugins install í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.
Install suggested pluginsë¥¼ ëˆŒëŸ¬ì¤€ë‹¤.

í–¥í›„ì˜ í•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ë“¤ì€ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.
suggested pluginsë§Œ í•´ë„ 5ë¶„ ì •ë„ ê±¸ë¦¬ëŠ” ê²ƒ ê°™ë‹¤. ê°„ë‹¨í•˜ê²Œ ì»¤í”¼ë‚˜ í•œì” í•˜ì.

installì´ ë‹¤ë˜ë©´ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ì°½ì´ ë‚˜ì˜¨ë‹¤. ëŒ€ì¶© ì´ì •ë„ ì“°ë©´ ëœë‹¤.

Username: admin
Password: {pw} -> vn~1234
Confirm password: {pw}
Full name: admin
E-mail address: {ë³¸ì¸ id}@gmail.com -> hdeoksang@gmail.com


ì§œì”! ì  í‚¨ìŠ¤ í™ˆí˜ì´ì§€ì— ë“¤ì–´ê°€ì§„ë‹¤.

ì´ìƒ ì„¤ì¹˜ ì™„ë£Œ.....




### Jenkins sudo ëª…ë ¹ ê¶Œí•œ ë¶€ì—¬(ì•ˆí•´ë„ ë¨)

ğŸ’¥sudo: a terminal is required to read the password ì˜¤ë¥˜

ì‰˜ì— ì…ë ¥ëœ ëª…ë ¹ì— sudo ëª…ë ¹ì„ ì  í‚¨ìŠ¤ì—ì„œ ì‹œë„í•˜ë ¤ë©´ ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šì•„ ìƒê¸°ëŠ” ë¬¸ì œì´ë‹¤.

ì  í‚¨ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì— ê°€ì„œ
sudo vi /etc/sudoers
vi ì—ë””í„°ë¡œ sudoersë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

~~ ì´ ê³³ì— ì•„ë˜ ë‚´ìš©ì„ ê¸°ì…í•˜ë©´ í•´ê²°ëœë‹¤.

jenkins ALL=(ALL) NOPASSWD: ALL
~~
ì¶œì²˜: https://cokes.tistory.com/121 [Cokes Blog]


ì°¸ê³ 
https://www.jenkins.io/doc/book/installing/linux/#debianubuntu
https://cokes.tistory.com/121 [Cokes Blog]
profile
devdo
